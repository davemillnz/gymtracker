<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About This Project - GymTracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=SITE_KEY"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold">GymTracker</h1>
                </div>
                <div class="flex space-x-4">
                    <a href="/" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">Home</a>
                    <a href="/about" class="px-3 py-2 rounded-md text-sm font-medium bg-blue-700">About</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- About Section -->
        <div class="bg-white rounded-lg shadow-md p-8 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">About This Project</h1>
            
            <div class="prose prose-lg text-gray-700 space-y-4">
                <p>
                    GymTracker is a modern web application that allows you to upload workout data exported from the Strong app 
                    to generate insightful graphs and statistics. Simply upload your CSV export and instantly visualize your 
                    progress over time with detailed analysis of your lifts.
                </p>
                
                <p>
                    <strong>Current Features:</strong>
                </p>
                <ul class="list-disc pl-6 space-y-2">
                    <li>CSV upload and processing from Strong app exports</li>
                    <li>Exercise-specific analysis with fuzzy matching</li>
                    <li>Progress graphs showing best sets per session</li>
                    <li>1RM estimation using the Epley formula</li>
                    <li>Weekly workout frequency summaries</li>
                    <li>Clean, responsive interface built with TailwindCSS</li>
                </ul>
                
                <p>
                    <strong>Future Features:</strong> We're planning to add user accounts, database storage for workout history, 
                    personal record tracking, support for other fitness apps, and social features for progress sharing.
                </p>
                
                <p>
                    <strong>We'd love your feedback!</strong> If you have suggestions, found bugs, or want to share example data 
                    to help improve the app, please use the form below. For CSV uploads, we recommend only sharing the first 
                    30 lines of your data to protect your privacy.
                </p>
            </div>
        </div>

        <!-- Feedback Form Section -->
        <div class="bg-white rounded-lg shadow-md p-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Feedback & Data Upload</h2>
            
            <form id="feedbackForm" class="space-y-6">
                <!-- Feedback Text -->
                <div>
                    <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                        Your Feedback (Optional)
                    </label>
                    <textarea 
                        id="message" 
                        name="message" 
                        rows="4" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Share your thoughts, suggestions, or report any issues..."
                    ></textarea>
                </div>

                <!-- CSV File Upload -->
                <div>
                    <label for="file" class="block text-sm font-medium text-gray-700 mb-2">
                        Upload CSV Sample (Optional)
                    </label>
                    <input 
                        type="file" 
                        id="file" 
                        name="file" 
                        accept=".csv" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <p class="text-sm text-gray-500 mt-1">
                        Please only upload the first 30 lines of your CSV file to protect your privacy. 
                        This helps us test and improve the app with real data formats.
                    </p>
                </div>

                <!-- Hidden reCAPTCHA -->
                <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response" />

                <!-- Submit Button -->
                <div>
                    <button 
                        type="submit" 
                        class="w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium"
                    >
                        Submit Feedback
                    </button>
                </div>
            </form>

            <!-- Response Message -->
            <div id="responseMessage" class="mt-4 hidden">
                <div id="successMessage" class="hidden p-4 bg-green-100 border border-green-400 text-green-700 rounded-md">
                    <p id="successText"></p>
                </div>
                <div id="errorMessage" class="hidden p-4 bg-red-100 border border-red-400 text-red-700 rounded-md">
                    <p id="errorText"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize reCAPTCHA (optional)
        let recaptchaAvailable = false;
        
        // Check if reCAPTCHA is available
        if (typeof grecaptcha !== 'undefined') {
            try {
                grecaptcha.ready(function() {
                    grecaptcha.execute('SITE_KEY', {action: 'feedback'}).then(function(token) {
                        document.getElementById('g-recaptcha-response').value = token;
                        recaptchaAvailable = true;
                    }).catch(function(error) {
                        console.log('reCAPTCHA not configured, proceeding without it');
                        recaptchaAvailable = false;
                    });
                });
            } catch (error) {
                console.log('reCAPTCHA not available, proceeding without it');
                recaptchaAvailable = false;
            }
        } else {
            console.log('reCAPTCHA not loaded, proceeding without it');
            recaptchaAvailable = false;
        }

        // Handle form submission
        document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            
            // Show loading state
            submitButton.textContent = 'Submitting...';
            submitButton.disabled = true;
            
            // Hide previous messages
            document.getElementById('responseMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
            
            try {
                const formData = new FormData(this);
                
                // Try to refresh reCAPTCHA token if available
                if (recaptchaAvailable && typeof grecaptcha !== 'undefined') {
                    try {
                        const token = await grecaptcha.execute('SITE_KEY', {action: 'feedback'});
                        formData.set('g-recaptcha-response', token);
                    } catch (error) {
                        console.log('Failed to get reCAPTCHA token, proceeding without it');
                        formData.set('g-recaptcha-response', '');
                    }
                } else {
                    formData.set('g-recaptcha-response', '');
                }
                
                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Show success message
                    document.getElementById('successText').textContent = result.message;
                    document.getElementById('successMessage').classList.remove('hidden');
                    document.getElementById('responseMessage').classList.remove('hidden');
                    
                    // Reset form
                    this.reset();
                    
                    // Clear reCAPTCHA field
                    document.getElementById('g-recaptcha-response').value = '';
                } else {
                    // Show error message
                    document.getElementById('errorText').textContent = result.error;
                    document.getElementById('errorMessage').classList.remove('hidden');
                    document.getElementById('responseMessage').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Form submission error:', error);
                // Show error message
                document.getElementById('errorText').textContent = 'An error occurred while submitting feedback. Please try again.';
                document.getElementById('errorMessage').classList.remove('hidden');
                document.getElementById('responseMessage').classList.remove('hidden');
            } finally {
                // Reset button state
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>
